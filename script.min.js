function loadData(){const e=localStorage.getItem("resourceSharePH");e&&(appData={...appData,...JSON.parse(e)})}function saveData(){localStorage.setItem("resourceSharePH",JSON.stringify(appData))}function initTabs(){const e=document.querySelectorAll(".tab-btn"),t=document.querySelectorAll(".tab-content"),n=document.getElementById("tab-select");function a(a){e.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active"));const o=Array.from(e).find(e=>e.dataset.tab===a);o&&o.classList.add("active");const r=document.getElementById(a);r&&(document.querySelectorAll(".tab-content").forEach(e=>{e.style.transition="",e.style.opacity="",e.style.transform=""}),r.classList.add("active")),n&&(n.value=a)}if(e.forEach(e=>{e.addEventListener("click",()=>{a(e.dataset.tab)})}),n){const t={share:"ü§ù",request:"üÜò",kitchen:"üç≤",transport:"üöó",users:"üë•"},o="undefined"!=typeof auth&&auth.isLoggedIn()&&auth.getCurrentUser()&&"admin"===auth.getCurrentUser().role;0===n.options.length&&e.forEach(e=>{if(e.classList.contains("admin-only")&&!o)return;const a=document.createElement("option");a.value=e.dataset.tab;const r=t[e.dataset.tab]||"";a.textContent=`${r} ${e.textContent.trim()}`,n.appendChild(a)}),n.addEventListener("change",()=>{a(n.value)})}const o=document.querySelector(".tab-btn.active")||e[0];o&&a(o.dataset.tab)}function shareResource(){const e=document.getElementById("resource-name").value,t=document.getElementById("resource-category").value,n=document.getElementById("resource-location").value,a=document.getElementById("resource-contact").value,o=document.getElementById("resource-notes").value;if(!(e&&t&&n&&a))return void alert("Please fill in all required fields");const r={id:Date.now(),name:e,category:t,location:n,contact:a,notes:o,dateShared:(new Date).toLocaleDateString(),username:auth.getCurrentUser().username};appData.resources.push(r),saveData(),renderResources(),clearResourceForm()}function clearResourceForm(){document.getElementById("resource-name").value="",document.getElementById("resource-category").value="",document.getElementById("resource-location").value="",document.getElementById("resource-contact").value="",document.getElementById("resource-notes").value=""}function renderResources(){const e=document.getElementById("available-resources");if(0===appData.resources.length)return void(e.innerHTML='<div class="empty-state">No resources shared yet. Be the first to help your community!</div>');const t=auth.getCurrentUser();e.innerHTML=appData.resources.map(e=>`\n        <div class="resource-item">\n            <div class="item-header">\n                <div class="item-title">${e.name}</div>\n                <div class="item-category">${getCategoryLabel(e.category)}</div>\n            </div>\n            <div class="item-details">\n                <div class="item-location">üìç ${e.location}</div>\n                ${e.notes?`<p>${e.notes}</p>`:""}\n                <small>Shared on ${e.dateShared} by ${e.username}</small>\n            </div>\n            <div class="item-contact">üìû ${e.contact}</div>\n            ${e.username===t.username||"admin"===t.role?`<div class="crud-buttons">\n                    <button onclick="editResource(${e.id})" class="edit-btn">Edit</button>\n                    <button onclick="deleteResource(${e.id})" class="delete-btn">Delete</button>\n                </div>`:""}\n        </div>\n    `).join("")}function submitRequest(){const e=document.getElementById("request-need").value,t=document.getElementById("request-urgency").value,n=document.getElementById("request-location").value,a=document.getElementById("request-contact").value,o=document.getElementById("request-details").value;if(!(e&&t&&n&&a))return void alert("Please fill in all required fields");const r={id:Date.now(),need:e,urgency:t,location:n,contact:a,details:o,dateRequested:(new Date).toLocaleDateString(),username:auth.getCurrentUser().username};appData.requests.push(r),saveData(),renderRequests(),clearRequestForm()}function clearRequestForm(){document.getElementById("request-need").value="",document.getElementById("request-urgency").value="",document.getElementById("request-location").value="",document.getElementById("request-contact").value="",document.getElementById("request-details").value=""}function renderRequests(){const e=document.getElementById("help-requests");if(0===appData.requests.length)return void(e.innerHTML='<div class="empty-state">No help requests at the moment.</div>');const t=appData.requests.sort((e,t)=>{const n={critical:0,urgent:1,moderate:2,low:3};return n[e.urgency]-n[t.urgency]}),n=auth.getCurrentUser();e.innerHTML=t.map(e=>`\n        <div class="request-item">\n            <div class="item-header">\n                <div class="item-title">${e.need}</div>\n                <div class="item-category urgency-${e.urgency}">${getUrgencyLabel(e.urgency)}</div>\n            </div>\n            <div class="item-details">\n                <div class="item-location">üìç ${e.location}</div>\n                ${e.details?`<p>${e.details}</p>`:""}\n                <small>Requested on ${e.dateRequested} by ${e.username}</small>\n            </div>\n            <div class="item-contact">üìû ${e.contact}</div>\n            ${e.username===n.username||"admin"===n.role?`<div class="crud-buttons">\n                    <button onclick="editRequest(${e.id})" class="edit-btn">Edit</button>\n                    <button onclick="deleteRequest(${e.id})" class="delete-btn">Delete</button>\n                </div>`:""}\n        </div>\n    `).join("")}function registerKitchen(){const e=document.getElementById("kitchen-location").value,t=document.getElementById("kitchen-date").value,n=document.getElementById("kitchen-time").value,a=document.getElementById("kitchen-capacity").value,o=document.getElementById("kitchen-menu").value;if(!(e&&t&&n&&a))return void alert("Please fill in all required fields");const r={id:Date.now(),location:e,date:t,time:n,capacity:parseInt(a),menu:o,dateRegistered:(new Date).toLocaleDateString(),username:auth.getCurrentUser().username};appData.kitchens.push(r),saveData(),renderKitchens(),clearKitchenForm()}function clearKitchenForm(){document.getElementById("kitchen-location").value="",document.getElementById("kitchen-date").value="",document.getElementById("kitchen-time").value="",document.getElementById("kitchen-capacity").value="",document.getElementById("kitchen-menu").value=""}function renderKitchens(){const e=document.getElementById("community-kitchens");if(0===appData.kitchens.length)return void(e.innerHTML='<div class="empty-state">No community kitchens registered yet.</div>');const t=auth.getCurrentUser();e.innerHTML=appData.kitchens.map(e=>`\n        <div class="kitchen-item">\n            <div class="item-header">\n                <div class="item-title">üç≤ ${e.location}</div>\n                <div class="item-category">Serves ${e.capacity}</div>\n            </div>\n            <div class="item-details">\n                <div><strong>üìÖ ${e.date} at ${e.time}</strong></div>\n                ${e.menu?`<p>Menu: ${e.menu}</p>`:""}\n                <small>Registered on ${e.dateRegistered} by ${e.username}</small>\n            </div>\n            ${e.username===t.username||"admin"===t.role?`<div class="crud-buttons">\n                    <button onclick="editKitchen(${e.id})" class="edit-btn">Edit</button>\n                    <button onclick="deleteKitchen(${e.id})" class="delete-btn">Delete</button>\n                </div>`:""}\n        </div>\n    `).join("")}function offerTransport(){const e=document.getElementById("transport-type").value,t=document.getElementById("transport-from").value,n=document.getElementById("transport-to").value,a=document.getElementById("transport-when").value,o=document.getElementById("transport-seats").value,r=document.getElementById("transport-contact").value;if(!(e&&t&&n&&a&&o&&r))return void alert("Please fill in all required fields");const c={id:Date.now(),type:e,from:t,to:n,when:a,seats:parseInt(o),contact:r,dateOffered:(new Date).toLocaleDateString(),username:auth.getCurrentUser().username};appData.transport.push(c),saveData(),renderTransport(),clearTransportForm()}function clearTransportForm(){document.getElementById("transport-type").value="",document.getElementById("transport-from").value="",document.getElementById("transport-to").value="",document.getElementById("transport-when").value="",document.getElementById("transport-seats").value="",document.getElementById("transport-contact").value=""}function renderTransport(){const e=document.getElementById("transport-list");if(0===appData.transport.length)return void(e.innerHTML='<div class="empty-state">No transportation offers available.</div>');const t=auth.getCurrentUser();e.innerHTML=appData.transport.map(e=>`\n        <div class="transport-item">\n            <div class="item-header">\n                <div class="item-title">${getTransportTypeLabel(e.type)}</div>\n                <div class="item-category">${e.seats} seats</div>\n            </div>\n            <div class="item-details">\n                <div><strong>üöó ${e.from} ‚Üí ${e.to}</strong></div>\n                <div>üìÖ ${new Date(e.when).toLocaleString()}</div>\n                <small>Offered on ${e.dateOffered} by ${e.username}</small>\n            </div>\n            <div class="item-contact">üìû ${e.contact}</div>\n            ${e.username===t.username||"admin"===t.role?`<div class="crud-buttons">\n                    <button onclick="editTransport(${e.id})" class="edit-btn">Edit</button>\n                    <button onclick="deleteTransport(${e.id})" class="delete-btn">Delete</button>\n                </div>`:""}\n        </div>\n    `).join("")}function editResource(e){const t=appData.resources.find(t=>t.id===e);if(!t)return;document.getElementById("resource-name").value=t.name,document.getElementById("resource-category").value=t.category,document.getElementById("resource-location").value=t.location,document.getElementById("resource-contact").value=t.contact,document.getElementById("resource-notes").value=t.notes;const n=document.querySelector(".resource-form button");n.onclick=()=>updateResource(e),n.textContent="Update Resource"}function updateResource(e){const t=document.getElementById("resource-name").value,n=document.getElementById("resource-category").value,a=document.getElementById("resource-location").value,o=document.getElementById("resource-contact").value,r=document.getElementById("resource-notes").value;if(!(t&&n&&a&&o))return void alert("Please fill in all required fields");const c=appData.resources.findIndex(t=>t.id===e);-1!==c&&(appData.resources[c]={...appData.resources[c],name:t,category:n,location:a,contact:o,notes:r},saveData(),renderResources(),clearResourceForm(),resetResourceForm())}function resetResourceForm(){const e=document.querySelector(".resource-form button");e.onclick=shareResource,e.textContent="Share Resource"}function editRequest(e){const t=appData.requests.find(t=>t.id===e);if(!t)return;document.getElementById("request-need").value=t.need,document.getElementById("request-urgency").value=t.urgency,document.getElementById("request-location").value=t.location,document.getElementById("request-contact").value=t.contact,document.getElementById("request-details").value=t.details;const n=document.querySelector(".request-form button");n.onclick=()=>updateRequest(e),n.textContent="Update Request"}function updateRequest(e){const t=document.getElementById("request-need").value,n=document.getElementById("request-urgency").value,a=document.getElementById("request-location").value,o=document.getElementById("request-contact").value,r=document.getElementById("request-details").value;if(!(t&&n&&a&&o))return void alert("Please fill in all required fields");const c=appData.requests.findIndex(t=>t.id===e);-1!==c&&(appData.requests[c]={...appData.requests[c],need:t,urgency:n,location:a,contact:o,details:r},saveData(),renderRequests(),clearRequestForm(),resetRequestForm())}function resetRequestForm(){const e=document.querySelector(".request-form button");e.onclick=submitRequest,e.textContent="Submit Request"}function editKitchen(e){const t=appData.kitchens.find(t=>t.id===e);if(!t)return;document.getElementById("kitchen-location").value=t.location,document.getElementById("kitchen-date").value=t.date,document.getElementById("kitchen-time").value=t.time,document.getElementById("kitchen-capacity").value=t.capacity,document.getElementById("kitchen-menu").value=t.menu;const n=document.querySelector(".kitchen-form button");n.onclick=()=>updateKitchen(e),n.textContent="Update Kitchen"}function updateKitchen(e){const t=document.getElementById("kitchen-location").value,n=document.getElementById("kitchen-date").value,a=document.getElementById("kitchen-time").value,o=document.getElementById("kitchen-capacity").value,r=document.getElementById("kitchen-menu").value;if(!(t&&n&&a&&o))return void alert("Please fill in all required fields");const c=appData.kitchens.findIndex(t=>t.id===e);-1!==c&&(appData.kitchens[c]={...appData.kitchens[c],location:t,date:n,time:a,capacity:parseInt(o),menu:r},saveData(),renderKitchens(),clearKitchenForm(),resetKitchenForm())}function resetKitchenForm(){const e=document.querySelector(".kitchen-form button");e.onclick=registerKitchen,e.textContent="Register Kitchen"}function editTransport(e){const t=appData.transport.find(t=>t.id===e);if(!t)return;document.getElementById("transport-type").value=t.type,document.getElementById("transport-from").value=t.from,document.getElementById("transport-to").value=t.to,document.getElementById("transport-when").value=t.when,document.getElementById("transport-seats").value=t.seats,document.getElementById("transport-contact").value=t.contact;const n=document.querySelector(".transport-form button");n.onclick=()=>updateTransport(e),n.textContent="Update Transport"}function updateTransport(e){const t=document.getElementById("transport-type").value,n=document.getElementById("transport-from").value,a=document.getElementById("transport-to").value,o=document.getElementById("transport-when").value,r=document.getElementById("transport-seats").value,c=document.getElementById("transport-contact").value;if(!(t&&n&&a&&o&&r&&c))return void alert("Please fill in all required fields");const s=appData.transport.findIndex(t=>t.id===e);-1!==s&&(appData.transport[s]={...appData.transport[s],type:t,from:n,to:a,when:o,seats:parseInt(r),contact:c},saveData(),renderTransport(),clearTransportForm(),resetTransportForm())}function resetTransportForm(){const e=document.querySelector(".transport-form button");e.onclick=offerTransport,e.textContent="Offer Transport"}function deleteResource(e){confirm("Are you sure you want to delete this resource?")&&(appData.resources=appData.resources.filter(t=>t.id!==e),saveData(),renderResources())}function deleteRequest(e){confirm("Are you sure you want to delete this request?")&&(appData.requests=appData.requests.filter(t=>t.id!==e),saveData(),renderRequests())}function deleteKitchen(e){confirm("Are you sure you want to delete this kitchen?")&&(appData.kitchens=appData.kitchens.filter(t=>t.id!==e),saveData(),renderKitchens())}function deleteTransport(e){confirm("Are you sure you want to delete this transport offer?")&&(appData.transport=appData.transport.filter(t=>t.id!==e),saveData(),renderTransport())}function getCategoryLabel(e){return{power:"Power & Electricity",water:"Water & Food",shelter:"Shelter & Supplies",medical:"Medical Supplies",tools:"Tools & Equipment"}[e]||e}function getUrgencyLabel(e){return{critical:"CRITICAL",urgent:"URGENT",moderate:"MODERATE",low:"LOW"}[e]||e}function getTransportTypeLabel(e){return{evacuation:"üö® Evacuation Transport",supplies:"üì¶ Supply Delivery",medical:"üè• Medical Emergency",general:"üöó General Transport"}[e]||e}document.addEventListener("DOMContentLoaded",function(){initTabs(),loadDataFromCSV()});