class CSVDatabase{constructor(){this.baseUrl="./assets/",this.tables={resources:"ShareResources.csv",requests:"RequestHelp.csv",kitchens:"CommunityKitchen.csv",transport:"Transportation.csv",users:"Users.csv"}}async loadTable(e){try{const a=this.baseUrl+"records/"+this.tables[e];let t=await fetch(a);if(t.ok||(t=await fetch(this.baseUrl+this.tables[e])),!t.ok)return console.error(`Failed to load ${e} from both records and assets:`,t.status),[];const s=await t.text();return this.parseCSV(s)}catch(a){return console.error(`Error loading ${e}:`,a),[]}}parseCSV(e){const a=e.trim().split("\n"),t=a[0].split(",");return a.slice(1).map(e=>{const a=e.split(","),s={};return t.forEach((e,t)=>{s[e.trim()]=a[t]?.trim()||""}),s})}toCSV(e,a){if(0===e.length)return a.join(",")+"\n";const t=[a.join(",")];return e.forEach(e=>{const s=a.map(a=>e[a]||"");t.push(s.join(","))}),t.join("\n")}downloadCSV(e,a,t){const s=this.toCSV(e,t),r=new Blob([s],{type:"text/csv"}),o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=a,n.click(),window.URL.revokeObjectURL(o)}downloadExcel(e,a,t){const s=this.toCSV(e,t),r=new Blob([s],{type:"application/vnd.ms-excel"}),o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=a.replace(".csv",".xlsx"),n.click(),window.URL.revokeObjectURL(o)}async loadAllData(){const[e,a,t,s,r]=await Promise.all([this.loadTable("resources"),this.loadTable("requests"),this.loadTable("kitchens"),this.loadTable("transport"),this.loadTable("users")]);return{resources:e,requests:a,kitchens:t,transport:s,users:r}}}const db=new CSVDatabase;let appData={resources:[],requests:[],kitchens:[],transport:[],users:[]};async function loadDataFromCSV(){if(auth.isLoggedIn())try{const e=await db.loadAllData();loadData();const a=localStorage.getItem("registeredUsers");if(a){const e=JSON.parse(a);auth.users=[...auth.users,...e]}const t=e.resources.map(e=>({id:parseInt(e.ID),name:e["Resource Name"],category:e.Category,location:e.Location,contact:e.Contact,notes:e.Notes,dateShared:e["Date Shared"],username:e.Username})),s=e.requests.map(e=>({id:parseInt(e.ID),need:e.Need,urgency:e.Urgency,location:e.Location,contact:e.Contact,details:e.Details,dateRequested:e["Date Requested"],username:e.Username})),r=e.kitchens.map(e=>({id:parseInt(e.ID),location:e.Location,date:e.Date,time:e.Time,capacity:parseInt(e.Capacity),menu:e.Menu,dateRegistered:e["Date Registered"],username:e.Username})),o=e.transport.map(e=>({id:parseInt(e.ID),type:e.Type,from:e.From,to:e.To,when:e.When,seats:parseInt(e.Seats),contact:e.Contact,dateOffered:e["Date Offered"],username:e.Username})),n=appData.resources.map(e=>e.id),c=appData.requests.map(e=>e.id),i=appData.kitchens.map(e=>e.id),d=appData.transport.map(e=>e.id);appData.resources=[...appData.resources,...t.filter(e=>!n.includes(e.id))],appData.requests=[...appData.requests,...s.filter(e=>!c.includes(e.id))],appData.kitchens=[...appData.kitchens,...r.filter(e=>!i.includes(e.id))],appData.transport=[...appData.transport,...o.filter(e=>!d.includes(e.id))],addLogoutButton(),showAdminElements(),renderResources(),renderRequests(),renderKitchens(),renderTransport()}catch(e){console.error("Error loading CSV data:",e),loadData()}else showLoginForm()}function exportToCSV(e){const a={resources:appData.resources.map(e=>({ID:e.id,"Resource Name":e.name,Category:e.category,Location:e.location,Contact:e.contact,Notes:e.notes,"Date Shared":e.dateShared,Username:e.username})),requests:appData.requests.map(e=>({ID:e.id,Need:e.need,Urgency:e.urgency,Location:e.location,Contact:e.contact,Details:e.details,"Date Requested":e.dateRequested,Username:e.username})),kitchens:appData.kitchens.map(e=>({ID:e.id,Location:e.location,Date:e.date,Time:e.time,Capacity:e.capacity,Menu:e.menu,"Date Registered":e.dateRegistered,Username:e.username})),transport:appData.transport.map(e=>({ID:e.id,Type:e.type,From:e.from,To:e.to,When:e.when,Seats:e.seats,Contact:e.contact,"Date Offered":e.dateOffered,Username:e.username})),users:auth.users.map(e=>({ID:e.ID,Username:e.Username,"Full Name":e.FullName,Role:e.Role,Barangay:e.Barangay,Phone:e.Phone,"Date Registered":e.DateRegistered}))};db.downloadCSV(a[e],`${e}.csv`,{resources:["ID","Resource Name","Category","Location","Contact","Notes","Date Shared","Username"],requests:["ID","Need","Urgency","Location","Contact","Details","Date Requested","Username"],kitchens:["ID","Location","Date","Time","Capacity","Menu","Date Registered","Username"],transport:["ID","Type","From","To","When","Seats","Contact","Date Offered","Username"],users:["ID","Username","Full Name","Role","Barangay","Phone","Date Registered"]}[e])}function exportToExcel(e){const a={resources:appData.resources.map(e=>({ID:e.id,"Resource Name":e.name,Category:e.category,Location:e.location,Contact:e.contact,Notes:e.notes,"Date Shared":e.dateShared,Username:e.username})),requests:appData.requests.map(e=>({ID:e.id,Need:e.need,Urgency:e.urgency,Location:e.location,Contact:e.contact,Details:e.details,"Date Requested":e.dateRequested,Username:e.username})),kitchens:appData.kitchens.map(e=>({ID:e.id,Location:e.location,Date:e.date,Time:e.time,Capacity:e.capacity,Menu:e.menu,"Date Registered":e.dateRegistered,Username:e.username})),transport:appData.transport.map(e=>({ID:e.id,Type:e.type,From:e.from,To:e.to,When:e.when,Seats:e.seats,Contact:e.contact,"Date Offered":e.dateOffered,Username:e.username})),users:auth.users.map(e=>({ID:e.ID,Username:e.Username,"Full Name":e.FullName,Role:e.Role,Barangay:e.Barangay,Phone:e.Phone,"Date Registered":e.DateRegistered}))};db.downloadExcel(a[e],`${e}.xlsx`,{resources:["ID","Resource Name","Category","Location","Contact","Notes","Date Shared","Username"],requests:["ID","Need","Urgency","Location","Contact","Details","Date Requested","Username"],kitchens:["ID","Location","Date","Time","Capacity","Menu","Date Registered","Username"],transport:["ID","Type","From","To","When","Seats","Contact","Date Offered","Username"],users:["ID","Username","Full Name","Role","Barangay","Phone","Date Registered"]}[e])}