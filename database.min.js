class CSVDatabase{constructor(){this.baseUrl="./assets/",this.tables={resources:"ShareResources.csv",requests:"RequestHelp.csv",kitchens:"CommunityKitchen.csv",transport:"Transportation.csv",users:"Users.csv"}}async loadTable(e){try{const t=await fetch(this.baseUrl+this.tables[e]);return this.parseCSV(await t.text())}catch(t){return console.error(`Error loading ${e}:`,t),[]}}parseCSV(e){const t=e.trim().split("\n"),s=t[0].split(",");return t.slice(1).map(e=>{const t=e.split(","),a={};return s.forEach((e,s)=>{a[e.trim()]=t[s]?.trim()||""}),a})}toCSV(e,t){if(0===e.length)return t.join(",")+"\n";const s=[t.join(",")];return e.forEach(e=>{const a=t.map(t=>e[t]||"");s.push(a.join(","))}),s.join("\n")}downloadCSV(e,t,s){const a=this.toCSV(e,s),r=new Blob([a],{type:"text/csv"}),o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o)}downloadExcel(e,t,s){const a=this.toCSV(e,s),r=new Blob([a],{type:"application/vnd.ms-excel"}),o=window.URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=t.replace(".csv",".xlsx"),n.click(),window.URL.revokeObjectURL(o)}async loadAllData(){const[e,t,s,a,r]=await Promise.all([this.loadTable("resources"),this.loadTable("requests"),this.loadTable("kitchens"),this.loadTable("transport"),this.loadTable("users")]);return{resources:e,requests:t,kitchens:s,transport:a,users:r}}}const db=new CSVDatabase;let appData={resources:[],requests:[],kitchens:[],transport:[],users:[]};async function loadDataFromCSV(){if(!auth.isLoggedIn())return void showLoginForm();try{const e=await db.loadAllData();loadData();const t=localStorage.getItem("registeredUsers");t&&(auth.users=[...auth.users,...JSON.parse(t)]);const s=e.resources.map(e=>({id:parseInt(e.ID),name:e["Resource Name"],category:e.Category,location:e.Location,contact:e.Contact,notes:e.Notes,dateShared:e["Date Shared"],username:e.Username})),a=e.requests.map(e=>({id:parseInt(e.ID),need:e.Need,urgency:e.Urgency,location:e.Location,contact:e.Contact,details:e.Details,dateRequested:e["Date Requested"],username:e.Username})),r=e.kitchens.map(e=>({id:parseInt(e.ID),location:e.Location,date:e.Date,time:e.Time,capacity:parseInt(e.Capacity),menu:e.Menu,dateRegistered:e["Date Registered"],username:e.Username})),o=e.transport.map(e=>({id:parseInt(e.ID),type:e.Type,from:e.From,to:e.To,when:e.When,seats:parseInt(e.Seats),contact:e.Contact,dateOffered:e["Date Offered"],username:e.Username})),n=appData.resources.map(e=>e.id),i=appData.requests.map(e=>e.id),c=appData.kitchens.map(e=>e.id),l=appData.transport.map(e=>e.id);appData.resources=[...appData.resources,...s.filter(e=>!n.includes(e.id))],appData.requests=[...appData.requests,...a.filter(e=>!i.includes(e.id))],appData.kitchens=[...appData.kitchens,...r.filter(e=>!c.includes(e.id))],appData.transport=[...appData.transport,...o.filter(e=>!l.includes(e.id))],addLogoutButton(),showAdminElements(),renderResources(),renderRequests(),renderKitchens(),renderTransport()}catch(e){console.error("Error loading CSV data:",e),loadData()}}function exportToCSV(e){const t={resources:["ID","Resource Name","Category","Location","Contact","Notes","Date Shared","Username"],requests:["ID","Need","Urgency","Location","Contact","Details","Date Requested","Username"],kitchens:["ID","Location","Date","Time","Capacity","Menu","Date Registered","Username"],transport:["ID","Type","From","To","When","Seats","Contact","Date Offered","Username"],users:["ID","Username","Full Name","Role","Barangay","Phone","Date Registered"]},s={resources:appData.resources.map(e=>({ID:e.id,"Resource Name":e.name,Category:e.category,Location:e.location,Contact:e.contact,Notes:e.notes,"Date Shared":e.dateShared,Username:e.username})),requests:appData.requests.map(e=>({ID:e.id,Need:e.need,Urgency:e.urgency,Location:e.location,Contact:e.contact,Details:e.details,"Date Requested":e.dateRequested,Username:e.username})),kitchens:appData.kitchens.map(e=>({ID:e.id,Location:e.location,Date:e.date,Time:e.time,Capacity:e.capacity,Menu:e.menu,"Date Registered":e.dateRegistered,Username:e.username})),transport:appData.transport.map(e=>({ID:e.id,Type:e.type,From:e.from,To:e.to,When:e.when,Seats:e.seats,Contact:e.contact,"Date Offered":e.dateOffered,Username:e.username})),users:auth.users.map(e=>({ID:e.ID,Username:e.Username,"Full Name":e.FullName,Role:e.Role,Barangay:e.Barangay,Phone:e.Phone,"Date Registered":e.DateRegistered}))};db.downloadCSV(s[e],`${e}.csv`,t[e])}function exportToExcel(e){const t={resources:["ID","Resource Name","Category","Location","Contact","Notes","Date Shared","Username"],requests:["ID","Need","Urgency","Location","Contact","Details","Date Requested","Username"],kitchens:["ID","Location","Date","Time","Capacity","Menu","Date Registered","Username"],transport:["ID","Type","From","To","When","Seats","Contact","Date Offered","Username"],users:["ID","Username","Full Name","Role","Barangay","Phone","Date Registered"]},s={resources:appData.resources.map(e=>({ID:e.id,"Resource Name":e.name,Category:e.category,Location:e.location,Contact:e.contact,Notes:e.notes,"Date Shared":e.dateShared,Username:e.username})),requests:appData.requests.map(e=>({ID:e.id,Need:e.need,Urgency:e.urgency,Location:e.location,Contact:e.contact,Details:e.details,"Date Requested":e.dateRequested,Username:e.username})),kitchens:appData.kitchens.map(e=>({ID:e.id,Location:e.location,Date:e.date,Time:e.time,Capacity:e.capacity,Menu:e.menu,"Date Registered":e.dateRegistered,Username:e.username})),transport:appData.transport.map(e=>({ID:e.id,Type:e.type,From:e.from,To:e.to,When:e.when,Seats:e.seats,Contact:e.contact,"Date Offered":e.dateOffered,Username:e.username})),users:auth.users.map(e=>({ID:e.ID,Username:e.Username,"Full Name":e.FullName,Role:e.Role,Barangay:e.Barangay,Phone:e.Phone,"Date Registered":e.DateRegistered}))};db.downloadExcel(s[e],`${e}.xlsx`,t[e])}